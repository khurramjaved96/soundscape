<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <title>PersonalScapes</title>

  <!-- update the version number as needed -->
  <script defer src="/__/firebase/10.11.1/firebase-app-compat.js"></script>
  <!-- include only the Firebase features as you need -->
  <script defer src="/__/firebase/10.11.1/firebase-auth-compat.js"></script>
  <script defer src="/__/firebase/10.11.1/firebase-database-compat.js"></script>
  <script defer src="/__/firebase/10.11.1/firebase-firestore-compat.js"></script>
  <script defer src="/__/firebase/10.11.1/firebase-functions-compat.js"></script>
  <script defer src="/__/firebase/10.11.1/firebase-messaging-compat.js"></script>
  <script defer src="/__/firebase/10.11.1/firebase-storage-compat.js"></script>
  <script defer src="/__/firebase/10.11.1/firebase-analytics-compat.js"></script>
  <script defer src="/__/firebase/10.11.1/firebase-remote-config-compat.js"></script>
  <script defer src="/__/firebase/10.11.1/firebase-performance-compat.js"></script>

  <link rel="stylesheet" href="https://use.typekit.net/cyl2tsd.css">

  <script src="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth.js"></script>
  <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.1.0/firebase-ui-auth.css"/>
  <!--
    initialize the SDK after all desired features are loaded, set useEmulator to false
    to avoid connecting the SDK to running emulators.
  -->
  <script defer src="/__/firebase/init.js?useEmulator=true"></script>
</head>
<body class="bg-gradient-to-r   from-slate-100 to-slate-500">

<audio id="rain" src="rain.mp3"></audio>
<audio id="fireplace" src="fireplace.mp3"></audio>
<audio id="waves" src="waves.mp3"></audio>
<audio id="thunder" src="thunder.mp3"></audio>
<audio id="kids" src="kids.mp3"></audio>


<div class="container filter drop-shadow-lg mx-auto">

  <div class="grid grid-cols-2">
    <div class="mx-auto my-auto text-slate-100" id="user">User: </div>
    <button class="mx-auto my-auto text-slate-100" id="signout" onclick="firebase.auth().signOut()">Sign out</button>
  </div>
  <div class="pt-4 pl-8 pr-8 pb-2">
    <div id='heading'
         class="text-center  tracking-wide text-6xl text-slate-100 mx-auto my-8">
      Compose your soundscape
    </div>
  </div>
  <div id='parentBox'
       class="flex rounded-full   px-4 py-4 bg-opacity-30 bg-white  relative  w-5/12 aspect-square mx-auto">
    <div id="headDiv" class="mx-auto my-auto">

      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
           class="md:w-24 md:h-24 h-12 w-12 fill-slate-500" fill="currentColor" viewBox="0 0 256 256"
           xml:space="preserve">
                <g><g><g><path  d="M231.7,140.5c0-10.4-5.8-19.2-14-22.8c-0.7-9.2-1.2-17.3-0.9-20.8c0.8-10.1,8.1-52,0.8-62.6c-6.1-8.9-17.2-12.9-20.5-13.9L172.2,10l-7.5,12.6l23.5,12.6c2.8,1.7,14.3,9.1,17.8,15c1.7,2.9,2.6,8.1,3.2,13.1c-2.4-4.1-5.5-8.5-9.4-12.9C187.9,37,166.4,21.2,130,21.2c-0.8,0-1.7,0-2.6,0c-31.4,0.6-55.7,10-72.3,28c-12,13-17.7,28.6-19,38.8c-1.3,7.7-1.3,18.8-0.4,30.9c-6.8,4.2-11.4,12.2-11.4,21.5c0,10.9,6.3,20,15,23.4c7.8,46.7,44.3,82.1,88.1,82.1c21.2,0,40.8-8.4,56.1-22.3c-3.3,7.1-5.6,12.3-5.7,13.3c-0.3,3.6,9,10.6,10.7,8.7c1.6-1.9,26-61.4,26.8-68.2c0.4-3.6,0.6-9,0.6-13.3C225,161,231.7,151.7,231.7,140.5z M187.3,32.2l-19.4-10.4l5.3-8.8l20.5,8.6L187.3,32.2z M195.1,53.9c8,9,12.4,18.2,14.5,23.5c-0.3,4.4,0.2,16.3,0.7,30.2c-11.1-30.7-35.4-53.7-64.9-60.6c0-0.3,0.1-0.6-0.1-0.8l-2.4-4.4c-0.4-4.7-2.2-8.9-4.9-12.2v-2.5C161.8,28.8,180.9,37.8,195.1,53.9z M125.4,31c5.6,0,10.2,5.7,10.2,12.7c0,0.5-0.1,1.1-0.1,1.6c-2.6-0.2-5.3-0.5-8-0.5c-4.1,0-8.1,0.4-12,1c-0.1-0.7-0.2-1.4-0.2-2.1C115.2,36.7,119.8,31,125.4,31z M42,88.8c0.4-3.2,3.2-20.3,17.5-35.7c13.1-14.2,31.7-22.7,55.2-25.3c-4.2,3.7-7,9.4-7,15.9c0,0.8,0.1,1.5,0.2,2.3l-0.1,0.2c-0.2,0.4-0.2,0.8-0.1,1.2c-31.5,8-56.7,34.7-65.9,69.1c-0.6,0.1-1.1,0.4-1.6,0.6C38.4,99.4,41.3,94.1,42,88.8z M32,140.5c0-5,1.8-9.5,4.6-12.6c0.4,4.1,0.9,8.4,1.5,12.6c-0.1,1.7-0.2,3.3-0.2,5c0,3.1,0.1,6.2,0.4,9.2C34.5,151.6,32,146.4,32,140.5z M127.4,238.6c-32.8,0-61.2-22.1-74.2-53.8c-2.2-7.2-4.8-18.6-7.5-32.7c-0.1-2.2-0.3-4.5-0.3-6.7c0-51.4,36.8-93.2,82.1-93.2c45.3,0,82.1,41.8,82.1,93.2S172.7,238.6,127.4,238.6z M220.6,151.4c-0.5-5.8-1.3-15-2.1-24.4c3.4,3.2,5.7,8,5.7,13.6C224.1,144.7,222.7,148.4,220.6,151.4z"/></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></g></g>
</svg>
    </div>
    <div id="soundWaves" class="absolute w-12 h-12 right-0">
      <svg class="md:w-12 md:h-12 h-6 w-6  fill-slate-500" stroke-width="0" fill="currentColor"
           viewBox="0 0 28 28" version="1.1" xmlns="http://www.w3.org/2000/svg"
           xmlns:xlink="http://www.w3.org/1999/xlink">
        <path d="M13.3273272,15.7466668 C13.7045496,15.4037373 14.2724576,15.4030196 14.6497962,15.7263586 L14.7399401,15.8139341 L22.4793884,24.3273272 C22.6467265,24.5113992 22.7394483,24.751234 22.7394483,25 C22.7394483,25.5128358 22.3534081,25.9355072 21.8560694,25.9932723 L21.7394483,26 L6.26054465,26 C6.01178566,26 5.77195088,25.9072782 5.58787891,25.7399401 C5.21065649,25.3970106 5.15597791,24.8317405 5.44199817,24.4253848 L5.52061163,24.3273272 L13.2600599,15.8139341 C13.2814025,15.7904572 13.3038503,15.7680094 13.3273272,15.7466668 Z M14,2 C21.1797017,2 27,7.82029825 27,15 C27,18.2793134 25.7857775,21.27503 23.7823937,23.5620884 L23.6905236,23.4372331 L23.5892985,23.318318 L22.7800259,22.427431 C24.4768116,20.4236598 25.5,17.8313191 25.5,15 C25.5,8.64872538 20.3512746,3.5 14,3.5 C7.64872538,3.5 2.5,8.64872538 2.5,15 C2.5,17.8313191 3.52318836,20.4236598 5.21997406,22.427431 L4.41070152,23.318318 C4.344361,23.3912926 4.28314322,23.4773257 4.22702717,23.574518 C2.21632355,21.2802112 1,18.2821494 1,15 C1,7.82029825 6.82029825,2 14,2 Z M14,6 C18.9705627,6 23,10.0294373 23,15 C23,17.0970131 22.2828078,19.0265169 21.0803273,20.5566077 L20.0535231,19.4286002 C20.9629732,18.1875652 21.5,16.6564972 21.5,15 C21.5,10.8578644 18.1421356,7.5 14,7.5 C9.85786438,7.5 6.5,10.8578644 6.5,15 C6.5,16.6564972 7.0370268,18.1875652 7.94647688,19.4286002 L6.91967274,20.5566077 C5.71719218,19.0265169 5,17.0970131 5,15 C5,10.0294373 9.02943725,6 14,6 Z M14,10 C16.7614237,10 19,12.2385763 19,15 C19,15.9195112 18.7517897,16.7810497 18.3187153,17.5212695 L17.2381649,16.3306861 C17.4069266,15.9204527 17.5,15.4710956 17.5,15 C17.5,13.0670034 15.9329966,11.5 14,11.5 C12.0670034,11.5 10.5,13.0670034 10.5,15 C10.5,15.4710956 10.5930734,15.9204527 10.7618351,16.3306861 L9.68128471,17.5212695 C9.2482103,16.7810497 9,15.9195112 9,15 C9,12.2385763 11.2385763,10 14,10 Z"
              id="ðŸŽ¨-Color">

        </path>
      </svg>


      <p class="text-center text-slate-500">Waves</p>
    </div>
    <div id="soundKids" class="absolute w-12 h-12">
      <svg class="md:w-12 md:h-12 h-6 w-6  fill-slate-500" stroke-width="0" fill="currentColor"
           viewBox="0 0 28 28" version="1.1" xmlns="http://www.w3.org/2000/svg"
           xmlns:xlink="http://www.w3.org/1999/xlink">
        <path d="M13.3273272,15.7466668 C13.7045496,15.4037373 14.2724576,15.4030196 14.6497962,15.7263586 L14.7399401,15.8139341 L22.4793884,24.3273272 C22.6467265,24.5113992 22.7394483,24.751234 22.7394483,25 C22.7394483,25.5128358 22.3534081,25.9355072 21.8560694,25.9932723 L21.7394483,26 L6.26054465,26 C6.01178566,26 5.77195088,25.9072782 5.58787891,25.7399401 C5.21065649,25.3970106 5.15597791,24.8317405 5.44199817,24.4253848 L5.52061163,24.3273272 L13.2600599,15.8139341 C13.2814025,15.7904572 13.3038503,15.7680094 13.3273272,15.7466668 Z M14,2 C21.1797017,2 27,7.82029825 27,15 C27,18.2793134 25.7857775,21.27503 23.7823937,23.5620884 L23.6905236,23.4372331 L23.5892985,23.318318 L22.7800259,22.427431 C24.4768116,20.4236598 25.5,17.8313191 25.5,15 C25.5,8.64872538 20.3512746,3.5 14,3.5 C7.64872538,3.5 2.5,8.64872538 2.5,15 C2.5,17.8313191 3.52318836,20.4236598 5.21997406,22.427431 L4.41070152,23.318318 C4.344361,23.3912926 4.28314322,23.4773257 4.22702717,23.574518 C2.21632355,21.2802112 1,18.2821494 1,15 C1,7.82029825 6.82029825,2 14,2 Z M14,6 C18.9705627,6 23,10.0294373 23,15 C23,17.0970131 22.2828078,19.0265169 21.0803273,20.5566077 L20.0535231,19.4286002 C20.9629732,18.1875652 21.5,16.6564972 21.5,15 C21.5,10.8578644 18.1421356,7.5 14,7.5 C9.85786438,7.5 6.5,10.8578644 6.5,15 C6.5,16.6564972 7.0370268,18.1875652 7.94647688,19.4286002 L6.91967274,20.5566077 C5.71719218,19.0265169 5,17.0970131 5,15 C5,10.0294373 9.02943725,6 14,6 Z M14,10 C16.7614237,10 19,12.2385763 19,15 C19,15.9195112 18.7517897,16.7810497 18.3187153,17.5212695 L17.2381649,16.3306861 C17.4069266,15.9204527 17.5,15.4710956 17.5,15 C17.5,13.0670034 15.9329966,11.5 14,11.5 C12.0670034,11.5 10.5,13.0670034 10.5,15 C10.5,15.4710956 10.5930734,15.9204527 10.7618351,16.3306861 L9.68128471,17.5212695 C9.2482103,16.7810497 9,15.9195112 9,15 C9,12.2385763 11.2385763,10 14,10 Z"
              id="ðŸŽ¨-Color">

        </path>
      </svg>


      <p class="text-center text-slate-500">Kids playing</p>
    </div>
    <div id="soundFirePlace" class="absolute  bottom-0">
      <svg class="md:w-12 md:h-12 h-6 w-6  fill-slate-500" stroke-width="0" fill="currentColor"
           viewBox="0 0 28 28" version="1.1" xmlns="http://www.w3.org/2000/svg"
           xmlns:xlink="http://www.w3.org/1999/xlink">
        <path d="M13.3273272,15.7466668 C13.7045496,15.4037373 14.2724576,15.4030196 14.6497962,15.7263586 L14.7399401,15.8139341 L22.4793884,24.3273272 C22.6467265,24.5113992 22.7394483,24.751234 22.7394483,25 C22.7394483,25.5128358 22.3534081,25.9355072 21.8560694,25.9932723 L21.7394483,26 L6.26054465,26 C6.01178566,26 5.77195088,25.9072782 5.58787891,25.7399401 C5.21065649,25.3970106 5.15597791,24.8317405 5.44199817,24.4253848 L5.52061163,24.3273272 L13.2600599,15.8139341 C13.2814025,15.7904572 13.3038503,15.7680094 13.3273272,15.7466668 Z M14,2 C21.1797017,2 27,7.82029825 27,15 C27,18.2793134 25.7857775,21.27503 23.7823937,23.5620884 L23.6905236,23.4372331 L23.5892985,23.318318 L22.7800259,22.427431 C24.4768116,20.4236598 25.5,17.8313191 25.5,15 C25.5,8.64872538 20.3512746,3.5 14,3.5 C7.64872538,3.5 2.5,8.64872538 2.5,15 C2.5,17.8313191 3.52318836,20.4236598 5.21997406,22.427431 L4.41070152,23.318318 C4.344361,23.3912926 4.28314322,23.4773257 4.22702717,23.574518 C2.21632355,21.2802112 1,18.2821494 1,15 C1,7.82029825 6.82029825,2 14,2 Z M14,6 C18.9705627,6 23,10.0294373 23,15 C23,17.0970131 22.2828078,19.0265169 21.0803273,20.5566077 L20.0535231,19.4286002 C20.9629732,18.1875652 21.5,16.6564972 21.5,15 C21.5,10.8578644 18.1421356,7.5 14,7.5 C9.85786438,7.5 6.5,10.8578644 6.5,15 C6.5,16.6564972 7.0370268,18.1875652 7.94647688,19.4286002 L6.91967274,20.5566077 C5.71719218,19.0265169 5,17.0970131 5,15 C5,10.0294373 9.02943725,6 14,6 Z M14,10 C16.7614237,10 19,12.2385763 19,15 C19,15.9195112 18.7517897,16.7810497 18.3187153,17.5212695 L17.2381649,16.3306861 C17.4069266,15.9204527 17.5,15.4710956 17.5,15 C17.5,13.0670034 15.9329966,11.5 14,11.5 C12.0670034,11.5 10.5,13.0670034 10.5,15 C10.5,15.4710956 10.5930734,15.9204527 10.7618351,16.3306861 L9.68128471,17.5212695 C9.2482103,16.7810497 9,15.9195112 9,15 C9,12.2385763 11.2385763,10 14,10 Z"
              id="ðŸŽ¨-Color">

        </path>
      </svg>

      <p class="text-center text-slate-500">Fire</p>
    </div>
  </div>

</div>
<div class="rounded-lg  divide-y-2 divide-slate-400 divide-opacity-25 divide-solid relative bg-opacity-30 bg-white m-4 w-3/12  mx-auto">

  <div class="grid place-items-center mb-2 pt-2 pb-2 mt-4 w-full  ">
    <canvas id="canvasCtx" height="50" class="w-max"></canvas>
  </div>
  <div class="grid place-items-center pt-2">

    <div class="">
      <button id="playbutton">
        <!--                    Play-->
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
             stroke="currentColor" class="w-8 h-8  stroke-slate-500 hover:stroke-blue-500">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M21 7.5V18M15 7.5V18M3 16.811V8.69c0-.864.933-1.406 1.683-.977l7.108 4.061a1.125 1.125 0 0 1 0 1.954l-7.108 4.061A1.125 1.125 0 0 1 3 16.811Z"/>
        </svg>

      </button>
      <button onclick="addLike()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
             stroke="currentColor" class="w-8 h-8 stroke-slate-500  hover:stroke-green-600 ">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904m10.598-9.75H14.25M5.904 18.5c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 0 1-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 9.953 4.167 9.5 5 9.5h1.053c.472 0 .745.556.5.96a8.958 8.958 0 0 0-1.302 4.665c0 1.194.232 2.333.654 3.375Z"/>
        </svg>

      </button>
      <button onclick="addDislike()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
             stroke="currentColor" class="w-8 h-8 stroke-slate-500 hover:stroke-red-600">
          <path stroke-linecap="round" stroke-linejoin="round"
                d="M7.498 15.25H4.372c-1.026 0-1.945-.694-2.054-1.715a12.137 12.137 0 0 1-.068-1.285c0-2.848.992-5.464 2.649-7.521C5.287 4.247 5.886 4 6.504 4h4.016a4.5 4.5 0 0 1 1.423.23l3.114 1.04a4.5 4.5 0 0 0 1.423.23h1.294M7.498 15.25c.618 0 .991.724.725 1.282A7.471 7.471 0 0 0 7.5 19.75 2.25 2.25 0 0 0 9.75 22a.75.75 0 0 0 .75-.75v-.633c0-.573.11-1.14.322-1.672.304-.76.93-1.33 1.653-1.715a9.04 9.04 0 0 0 2.86-2.4c.498-.634 1.226-1.08 2.032-1.08h.384m-10.253 1.5H9.7m8.075-9.75c.01.05.027.1.05.148.593 1.2.925 2.55.925 3.977 0 1.487-.36 2.89-.999 4.125m.023-8.25c-.076-.365.183-.75.575-.75h.908c.889 0 1.713.518 1.972 1.368.339 1.11.521 2.287.521 3.507 0 1.553-.295 3.036-.831 4.398-.306.774-1.086 1.227-1.918 1.227h-1.053c-.472 0-.745-.556-.5-.96a8.95 8.95 0 0 0 .303-.54"/>
        </svg>
      </button>
    </div>
<!--    Add html slider-->
    <div class="grid place-items-center">
      <input type="range" min="0" max="100" value="50" class="slider" id="volumeSlider">
    </div>


  </div>


</div>

<style>
  #heading{
    font-family: "handsome-pro", sans-serif;
    font-style: normal;
  }
</style>


<script>

  const AudioContext = window.AudioContext || window.webkitAudioContext;
  const audioCtx = new AudioContext();
  const listener = audioCtx.listener;


  const analyser = audioCtx.createAnalyser();
  analyser.fftSize = 2048;

  listener.positionX.value = 0;
  listener.positionY.value = 0;
  listener.positionZ.value = 0;

  const panningModel = "HRTF";
  const innerCone = 360;
  const outerCone = 360;
  const outerGain = 0.3;
  const distanceModel = "inverse";

  const maxDistance = 10000;
  const refDistance = 1;
  const rollOff = 10;

  var positionX = -10.5
  var positionY = 0;
  var positionZ = 0;

  const orientationX = 0.0;
  const orientationY = 0.0;
  const orientationZ = -1.0;

  var pannerWaves = new PannerNode(audioCtx, {
    panningModel,
    distanceModel,
    positionX,
    positionY,
    positionZ,
    orientationX,
    orientationY,
    orientationZ,
    refDistance,
    maxDistance,
    rolloffFactor: rollOff,
    coneInnerAngle: innerCone,
    coneOuterAngle: outerCone,
    coneOuterGain: outerGain,
  });

  positionX = 10.5
  var pannerKids = new PannerNode(audioCtx, {
    panningModel,
    distanceModel,
    positionX,
    positionY,
    positionZ,
    orientationX,
    orientationY,
    orientationZ,
    refDistance,
    maxDistance,
    rolloffFactor: rollOff,
    coneInnerAngle: innerCone,
    coneOuterAngle: outerCone,
    coneOuterGain: outerGain,
  });


  positionX = 0
  positionZ = 10.5
  var pannerFirePlace = new PannerNode(audioCtx, {
    panningModel,
    distanceModel,
    positionX,
    positionY,
    positionZ,
    orientationX,
    orientationY,
    orientationZ,
    refDistance,
    maxDistance,
    rolloffFactor: rollOff,
    coneInnerAngle: innerCone,
    coneOuterAngle: outerCone,
    coneOuterGain: outerGain,
  });


  // get the audio element
  const audioElementWaves = document.getElementById("waves");
  const audioElementKids = document.getElementById("kids");
  const audioElementFirePlace = document.getElementById("fireplace");
  const audioElementThunder = document.getElementById("thunder");


  // pass it into the audio context

  const trackWaves = audioCtx.createMediaElementSource(audioElementWaves);
  const trackKids = audioCtx.createMediaElementSource(audioElementKids);
  const trackFirePlace = audioCtx.createMediaElementSource(audioElementFirePlace);
  trackWaves.connect(pannerWaves).connect(analyser);
  trackKids.connect(pannerKids).connect(analyser);
  const gainNode = audioCtx.createGain();
  trackFirePlace.connect(pannerFirePlace).connect(analyser).connect(gainNode);
  gainNode.connect(audioCtx.destination);


  // Add volume slider
  const volumeSlider = document.getElementById("volumeSlider");
  volumeSlider.addEventListener("input", function () {
    gainNode.gain.value = volumeSlider.value / 10;
  });


  const canvasCtx = document.getElementById("canvasCtx").getContext("2d");
  const HEIGHT = canvasCtx.canvas.height;
  const WIDTH = canvasCtx.canvas.width;

  const bufferLength = analyser.frequencyBinCount;
  const dataArray = new Uint8Array(bufferLength);
  canvasCtx.clearRect(0, 0, WIDTH, HEIGHT);

  function draw() {
    drawVisual = requestAnimationFrame(draw);
    analyser.getByteFrequencyData(dataArray);
    canvasCtx.clearRect(0, 0, WIDTH, HEIGHT);
    const barWidth = (WIDTH / bufferLength) * 10;
    let barHeight;
    let x = 0;
    for (let i = 0; i < bufferLength; i++) {
      barHeight = dataArray[i] / 2;

      canvasCtx.fillStyle = `rgb(250 250 250)`;
      canvasCtx.fillRect(x, HEIGHT / 2 - barHeight / 4, barWidth, barHeight / 2);

      x += barWidth + barWidth;
    }
  }


  draw();

  // Select our play button
  const playButton = document.getElementById("playbutton");
  playButton.dataset.playing = "false";
  playButton.addEventListener(
          "click",
          () => {
            console.log("Button pressed")
            // Check if context is in suspended state (autoplay policy)
            if (audioCtx.state === "suspended") {
              audioCtx.resume();
            }

            if (playButton.dataset.playing === "false") {
              console.log("PLaying")
              audioElementWaves.play();
              audioElementKids.play();
              audioElementFirePlace.play();
              playButton.dataset.playing = "true";
            } else if (playButton.dataset.playing === "true") {
              console.log("Pausing")
              audioElementWaves.pause();
              audioElementKids.pause();
              audioElementFirePlace.pause();
              playButton.dataset.playing = "false";
            }
          },
          false,
  );
  // Press playbutton


  // Make the DIV element draggable:
  wavesDrag = dragElement(document.getElementById("soundWaves"), pannerWaves, audioElementWaves);
  kidsDrag = dragElement(document.getElementById("soundKids"), pannerKids, audioElementKids);
  fireplaceDrag = dragElement(document.getElementById("soundFirePlace"), pannerFirePlace,  audioElementFirePlace);



  function dragElement(elmnt, pann, audoElem) {
    var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
    if (document.getElementById(elmnt.id + "header")) {
      document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
    } else {
      elmnt.onmousedown = dragMouseDown;
    }

    function dragMouseDown(e) {
      e = e || window.event;
      e.preventDefault();
      // get the mouse cursor position at startup:
      pos3 = e.clientX;
      pos4 = e.clientY;
      document.onmouseup = closeDragElement;
      // call a function whenever the cursor moves:
      document.onmousemove = elementDrag;
    }

    function elementDrag(e) {


      e = e || window.event;
      e.preventDefault();

      par = document.getElementById('parentBox');
      //print par heigth and width
      console.log(par.offsetHeight, par.offsetWidth)
      // calculate the new cursor position:
      pos1 = pos3 - e.clientX;
      pos2 = pos4 - e.clientY;
      pos3 = e.clientX;
      pos4 = e.clientY;
      // set the element's new position:
      elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
      elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
      // if left and top are greater than parent element height and width
      //     set left and top to parent element height and width
      // if left and top are less than 0
      //     set left and top to 0

      if (elmnt.offsetTop > par.offsetHeight - elmnt.offsetHeight) {
        elmnt.style.top = (par.offsetHeight - elmnt.offsetHeight) + "px";
      }
      if (elmnt.offsetTop - pos2 < 0) {
        elmnt.style.top = 0 + "px";
      }
      if (elmnt.offsetLeft - pos1 > par.offsetWidth - elmnt.offsetWidth) {
        elmnt.style.left = (par.offsetWidth - elmnt.offsetWidth) + "px";
      }
      if (elmnt.offsetLeft - pos1 < 0) {
        elmnt.style.left = 0 + "px";
      }


      // console.log(elmnt.offsetTop, elmnt.offsetLeft, window.innerHeight, window.innerWidth)
      pann.positionX.value = (((elmnt.offsetLeft - pos1) / par.offsetWidth) - 0.5) * 5;
      pann.positionZ.value = (((elmnt.offsetTop - pos2) / par.offsetHeight) - 0.5) * 5;
      // Check if the panner is in a radius of 3
      //     if it is, play the audio
      //     else pause the audio
      if (Math.sqrt(pann.positionX.value ** 2 + pann.positionZ.value ** 2) < 3) {
        // print playing
        console.log("Playing")
        audoElem.play();
      } else {
        // print paused
        console.log("Paused")
        audoElem.pause();
      }

      //     print position
      // console.log(pann.positionX.value, pann.positionZ.value)

    }

    function closeDragElement() {
      // stop moving when mouse button is released:
      document.onmouseup = null;
      document.onmousemove = null;
    }
  }

  document.addEventListener('DOMContentLoaded', function () {
    const loadEl = document.querySelector('#load');
    firebase.auth().onAuthStateChanged((user) => {
      if (!user) {
        window.location = '/login.html'; // If not signed in, go to login page
      }
      console.log(user);
      document.getElementById('user').textContent = "Logged in as: " + user.displayName;
    });

  });


  function addLike() {
    const db = firebase.firestore();

    console.log('Adding a like');
    db.collection("likes").add({
      user: firebase.auth().currentUser.displayName,
      // Store x,y,z location of panner of each song
      waves: [pannerWaves.positionX.value, pannerWaves.positionY.value, pannerWaves.positionZ.value],
      kids: [pannerKids.positionX.value, pannerKids.positionY.value, pannerKids.positionZ.value],
      fire: [pannerFirePlace.positionX.value, pannerFirePlace.positionY.value, pannerFirePlace.positionZ.value],


      time: firebase.firestore.FieldValue.serverTimestamp()
    })
            .then((docRef) => {
              console.log("Document written with ID: ", docRef.id);
            })
            .catch((error) => {
              console.error("Error adding document: ", error);
            });
    //     Log data to the database

  }

  function addDislike() {
    const db = firebase.firestore();

    console.log('Adding a dislike');
    db.collection("dislikes").add({
      user: firebase.auth().currentUser.displayName,
      // Store x,y,z location of panner of each song
      waves: [pannerWaves.positionX.value, pannerWaves.positionY.value, pannerWaves.positionZ.value],
      kids: [pannerKids.positionX.value, pannerKids.positionY.value, pannerKids.positionZ.value],
      fire: [pannerFirePlace.positionX.value, pannerFirePlace.positionY.value, pannerFirePlace.positionZ.value],
      time: firebase.firestore.FieldValue.serverTimestamp()
    })
            .then((docRef) => {
              console.log("Document written with ID: ", docRef.id);
            })
            .catch((error) => {
              console.error("Error adding document: ", error);
            });
  }

</script>
</body>
</html>
